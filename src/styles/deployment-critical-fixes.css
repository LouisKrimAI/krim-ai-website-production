/**
 * KRIM AI - CRITICAL DEPLOYMENT FIXES
 * Priority fixes for deployment readiness
 * Created: 2025-12-26
 * 
 * FIXES:
 * 1. Horizontal scroll at 768px (iPad breakpoint)
 * 2. Touch target violations (44px minimum)
 * 3. Typography minimum sizes (16px on mobile)
 * 4. Layout stability (CLS prevention)
 */

/* =============================================================================
   PRIORITY 1: FIX HORIZONTAL SCROLL AT 768px (TABLET/IPAD)
   ============================================================================= */

/* Global overflow prevention */
html,
body {
  overflow-x: hidden !important;
  max-width: 100vw !important;
  position: relative;
}

#root {
  overflow-x: hidden !important;
  max-width: 100vw !important;
  position: relative;
}

/* Container width constraints at all breakpoints */
* {
  max-width: 100vw;
}

/* Fix specific problematic elements */
.max-w-6xl,
.max-w-7xl,
.max-w-screen-xl {
  max-width: min(100%, var(--max-width, 100%));
  box-sizing: border-box;
}

/* Tablet-specific overflow fixes (768px) */
@media (min-width: 768px) and (max-width: 1023px) {
  /* Reset all containers to prevent overflow */
  [class*="container"],
  [class*="max-w-"],
  .px-6,
  .px-8,
  section,
  main {
    max-width: 100vw !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
  }
  
  /* Fix padding that might cause overflow */
  .px-6 {
    padding-left: min(1.5rem, 3vw) !important;
    padding-right: min(1.5rem, 3vw) !important;
  }
  
  .px-8 {
    padding-left: min(2rem, 4vw) !important;
    padding-right: min(2rem, 4vw) !important;
  }
  
  /* Fix grid layouts at tablet size */
  .grid {
    max-width: 100% !important;
    overflow-x: hidden !important;
  }
  
  /* Kula page 6-card grid specific fix */
  .grid.md\:grid-cols-2.lg\:grid-cols-3 {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
    gap: 1rem !important;
    padding: 0 1rem !important;
    max-width: 100% !important;
  }
  
  /* Fix all grid column configurations at tablet */
  .md\:grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
  
  .md\:grid-cols-3 {
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
  
  /* Ensure max-width containers don't exceed viewport */
  .max-w-6xl,
  .max-w-7xl {
    max-width: calc(100vw - 2rem) !important;
    margin-left: auto !important;
    margin-right: auto !important;
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
  
  /* Fix any element with fixed widths */
  [style*="width:"] {
    max-width: 100% !important;
  }
  
  /* Prevent images from causing overflow */
  img,
  picture,
  video,
  canvas,
  svg {
    max-width: 100% !important;
    height: auto !important;
  }
  
  /* Fix absolute positioned elements */
  [class*="absolute"],
  .fixed {
    max-width: 100vw !important;
  }
}

/* =============================================================================
   PRIORITY 2: FIX TOUCH TARGET VIOLATIONS (44px MINIMUM)
   ============================================================================= */

/* All interactive elements must have minimum 44px touch target */
a,
button,
input,
select,
textarea,
[role="button"],
[tabindex]:not([tabindex="-1"]),
.clickable,
.interactive {
  min-height: 44px !important;
  min-width: 44px !important;
  position: relative;
}

/* Ensure touch targets have proper tap area */
a::before,
button::before,
[role="button"]::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  min-width: 44px;
  min-height: 44px;
  pointer-events: none;
}

/* Navigation menu items - ensure proper sizing */
nav a,
nav button,
.nav-item,
header a,
header button {
  min-height: 44px !important;
  padding: 12px 16px !important;
  display: flex !important;
  align-items: center !important;
}

/* Mobile navigation specific */
@media (max-width: 768px) {
  /* Mobile menu items */
  .mobile-menu a,
  .mobile-menu button,
  [class*="mobile-nav"] a,
  [class*="mobile-nav"] button {
    min-height: 48px !important;
    padding: 14px 20px !important;
    width: 100% !important;
  }
  
  /* Footer links on mobile */
  footer a,
  footer button {
    min-height: 44px !important;
    display: inline-flex !important;
    align-items: center !important;
    padding: 10px !important;
  }
}

/* Fix skip links (accessibility) */
.skip-link,
[class*="skip-to"],
#skip-to-content,
a[href="#main"],
a[href="#content"],
a[href="#main-content"] {
  position: absolute !important;
  left: -9999px !important;
  z-index: 999999 !important;
  padding: 1rem !important;
  background: var(--krim-mint, #00FF88) !important;
  color: #000 !important;
  text-decoration: none !important;
  min-height: 44px !important;
  min-width: auto !important;
  display: inline-flex !important;
  align-items: center !important;
  font-weight: 600 !important;
  border-radius: 0.375rem !important;
}

.skip-link:focus,
[class*="skip-to"]:focus,
#skip-to-content:focus,
a[href="#main"]:focus,
a[href="#content"]:focus,
a[href="#main-content"]:focus {
  left: 1rem !important;
  top: 1rem !important;
  transform: none !important;
  width: auto !important;
  height: auto !important;
}

/* Cookie consent buttons */
.cookie-consent button,
[class*="cookie"] button,
[class*="consent"] button {
  min-height: 44px !important;
  padding: 12px 24px !important;
}

/* Form elements */
input[type="text"],
input[type="email"],
input[type="tel"],
input[type="password"],
input[type="number"],
input[type="date"],
input[type="search"],
select,
textarea {
  min-height: 44px !important;
  padding: 10px 12px !important;
  font-size: 16px !important; /* Prevents zoom on iOS */
}

/* Buttons - ensure all meet minimum requirements */
button,
.btn,
[class*="button"],
[type="submit"],
[type="button"],
[type="reset"] {
  min-height: 44px !important;
  padding: 10px 20px !important;
  cursor: pointer !important;
  font-size: max(16px, 1rem) !important;
}

/* Small buttons that need special handling */
.icon-button,
.close-button,
[aria-label*="close"],
[aria-label*="Close"] {
  min-width: 44px !important;
  min-height: 44px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* =============================================================================
   PRIORITY 3: TYPOGRAPHY FIXES (16px MINIMUM ON MOBILE)
   ============================================================================= */

/* Global minimum font size */
@media (max-width: 768px) {
  /* Ensure no text is smaller than 16px on mobile */
  body,
  p,
  span,
  div,
  li,
  td,
  th,
  label,
  input,
  select,
  textarea,
  button {
    font-size: max(16px, 1rem) !important;
    line-height: 1.5 !important;
  }
  
  /* Small text elements that often violate the rule */
  .text-xs,
  .text-sm,
  small,
  .small,
  .caption,
  .footnote {
    font-size: 16px !important;
  }
  
  /* Specific fixes for common violations */
  .text-white\/50,
  .text-white\/60,
  .text-white\/70,
  .opacity-50,
  .opacity-60,
  .opacity-70 {
    font-size: max(16px, 1rem) !important;
  }
  
  /* Form labels and helpers */
  label,
  .label,
  .help-text,
  .form-text,
  .input-hint {
    font-size: 16px !important;
  }
  
  /* Navigation and menu text */
  nav,
  .nav,
  .menu,
  header {
    font-size: max(16px, 1rem) !important;
  }
  
  /* Footer text */
  footer,
  footer * {
    font-size: max(16px, 1rem) !important;
  }
}

/* =============================================================================
   PRIORITY 4: LAYOUT STABILITY (CLS PREVENTION)
   ============================================================================= */

/* Reserve space for images */
img:not([width]):not([height]) {
  aspect-ratio: attr(width) / attr(height);
  width: 100%;
  height: auto;
}

/* Common aspect ratios for images */
img {
  aspect-ratio: var(--aspect-ratio, auto);
  max-width: 100%;
  height: auto;
  display: block;
}

/* Avatar images - consistent sizing */
.avatar,
[class*="avatar"] img {
  aspect-ratio: 1;
  object-fit: cover;
}

/* Hero images */
.hero img,
[class*="hero"] img {
  aspect-ratio: 16/9;
  width: 100%;
  height: auto;
  object-fit: cover;
}

/* Card images */
.card img,
[class*="card"] img {
  aspect-ratio: 16/9;
  width: 100%;
  height: auto;
  object-fit: cover;
}

/* Prevent layout shift from fonts */
@font-face {
  font-display: swap;
}

/* Skeleton screens for dynamic content */
.skeleton,
[class*="loading"] {
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.1) 25%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0.1) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
}

@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* =============================================================================
   ADDITIONAL CRITICAL FIXES
   ============================================================================= */

/* Fix text overflow on small screens */
@media (max-width: 768px) {
  h1, h2, h3, h4, h5, h6 {
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    -webkit-hyphens: auto !important;
  }
  
  p, span, div {
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
  }
}

/* Fix card grids on tablets */
@media (min-width: 768px) and (max-width: 1023px) {
  .grid-cols-3,
  .md\:grid-cols-3,
  .lg\:grid-cols-3 {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .grid-cols-4,
  .md\:grid-cols-4,
  .lg\:grid-cols-4 {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .grid-cols-6,
  .md\:grid-cols-6,
  .lg\:grid-cols-6 {
    grid-template-columns: repeat(3, 1fr) !important;
  }
}

/* Ensure proper z-index stacking */
.skip-link:focus {
  z-index: 999999 !important;
}

.modal,
[role="dialog"] {
  z-index: 10000 !important;
}

.toast,
.notification {
  z-index: 10001 !important;
}

/* Performance: Reduce animations on low-end devices */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* =============================================================================
   SPECIFIC 768px HORIZONTAL SCROLL FIXES
   ============================================================================= */

@media (width: 768px) {
  /* Extra specific fixes for exactly 768px (iPad) */
  body {
    width: 100vw !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
  }
  
  /* Fix Hero sections that often cause overflow */
  [class*="hero"],
  [class*="Hero"] {
    max-width: 100vw !important;
    overflow-x: hidden !important;
  }
  
  /* Fix absolute positioned decorative elements */
  .absolute,
  [class*="absolute"] {
    max-width: 100% !important;
    right: auto !important;
  }
  
  /* Ensure sections don't overflow */
  section {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
  }
}

/* =============================================================================
   ENHANCED TOUCH TARGET FIXES FOR SPECIFIC COMPONENTS
   ============================================================================= */

/* Fix nav-link class specifically */
.nav-link {
  min-height: 44px !important;
  padding: 10px 16px !important;
  display: inline-flex !important;
  align-items: center !important;
  box-sizing: border-box !important;
  font-size: max(16px, 1rem) !important; /* Ensure readable font size */
}

/* Mobile nav links font size fix */
@media (max-width: 768px) {
  .nav-link {
    font-size: 16px !important;
    line-height: 1.5 !important;
  }
}

/* Fix button variants */
.btn-primary,
.btn-secondary,
.btn-sm,
.btn-lg,
[class*="btn-"] {
  min-height: 44px !important;
  padding: 10px 20px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  box-sizing: border-box !important;
  font-size: max(16px, 1rem) !important;
}

/* Cookie consent specific fixes */
.cookie-consent button,
.cookie-consent a {
  min-height: 44px !important;
  min-width: 44px !important;
  padding: 12px 20px !important;
  font-size: 16px !important;
}

/* Skip link specific fix */
a[href="#main-content"] {
  min-width: 180px !important; /* Make skip link wider */
  white-space: nowrap !important;
}

/* =============================================================================
   DEBUG MODE (REMOVE BEFORE PRODUCTION)
   ============================================================================= */

/* Uncomment to debug layout issues */
/*
.debug-overflow * {
  outline: 1px solid red !important;
}

.debug-touch-targets a,
.debug-touch-targets button {
  outline: 2px solid lime !important;
  outline-offset: -2px;
}

.debug-font-size *:not(h1):not(h2):not(h3):not(h4):not(h5):not(h6) {
  position: relative;
}

.debug-font-size *:not(h1):not(h2):not(h3):not(h4):not(h5):not(h6)::after {
  content: attr(data-font-size);
  position: absolute;
  top: -20px;
  left: 0;
  font-size: 10px;
  color: red;
  background: white;
  padding: 2px;
  z-index: 9999;
  pointer-events: none;
}
*/